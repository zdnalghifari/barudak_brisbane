<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Barudak Brisbane</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css"/>
<style>
:root{
  --sand:#F5EFE0;--ocean:#1A6B7C;--deep:#0D3B47;
  --gold:#F4B942;--mint:#4DBFB0;--ink:#1C1C2E;
  --coral:#E8634A;--jog:#6ECC72;
  --sidebar-bg:#0b1120;
}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
html,body{background:var(--ink);color:var(--sand);font-family:'DM Sans',sans-serif;}

/* MOBILE default â€” body scrolls naturally */
body{display:flex;flex-direction:column;}

/* â•â• HEADER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
header{
  flex-shrink:0;z-index:500;
  padding:10px 14px;
  background:linear-gradient(135deg,#0D3B47,#071e28);
  border-bottom:1px solid rgba(77,191,176,.18);
  display:flex;align-items:center;justify-content:space-between;gap:8px;flex-wrap:wrap;
}
.hbrand{display:flex;flex-direction:column;gap:0;}
.heyebrow{font-size:8px;font-weight:500;letter-spacing:2.5px;text-transform:uppercase;color:var(--mint);opacity:.7;line-height:1;}
.htitle{font-family:'Syne',sans-serif;font-size:clamp(17px,3vw,23px);font-weight:800;color:var(--sand);letter-spacing:-.5px;line-height:1.1;}
.htitle span{color:var(--gold);}

/* TABS */
.tabs{display:flex;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.1);border-radius:50px;padding:3px;gap:2px;flex-shrink:0;}
.tb{font-family:'Syne',sans-serif;font-size:10px;font-weight:700;padding:6px 11px;border-radius:50px;border:none;cursor:pointer;transition:all .2s;color:rgba(245,239,224,.45);background:transparent;white-space:nowrap;}
.tb.a-brisbane{background:var(--ocean);color:#fff;box-shadow:0 2px 8px rgba(26,107,124,.5);}
.tb.a-goldcoast{background:var(--gold);color:var(--ink);box-shadow:0 2px 8px rgba(244,185,66,.5);}
.tb.a-jogging{background:var(--jog);color:#0a1a0a;box-shadow:0 2px 8px rgba(110,204,114,.5);}

/* â•â• MAIN LAYOUT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
/* MOBILE: stacked, body itself scrolls */
body{overflow-y:auto;}
.layout{display:flex;flex-direction:column;}

/* Map area â€” fixed height on mobile */
.mapwrap{position:relative;height:45vh;min-height:220px;flex-shrink:0;}
#map{width:100%;height:100%;}

/* Sidebar â€” natural height on mobile (no flex scroll trap) */
.sidebar{
  background:var(--sidebar-bg);
  border-top:1px solid rgba(255,255,255,.07);
  display:flex;flex-direction:column;
  padding-bottom:24px;
}

/* DESKTOP: side-by-side, full viewport height */
@media(min-width:700px){
  html,body{height:100%;}
  body{overflow:hidden;display:flex;flex-direction:column;}
  .layout{flex:1;min-height:0;flex-direction:row;}
  .mapwrap{flex:1;height:auto;}
  .sidebar{
    width:310px;flex-shrink:0;
    border-top:none;border-left:1px solid rgba(255,255,255,.07);
    overflow-y:auto;
    padding-bottom:0;
  }
  .slist{flex:1;overflow-y:auto;}
}

/* â•â• SIDEBAR INNER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.sb-head{flex-shrink:0;padding:12px 14px 9px;border-bottom:1px solid rgba(255,255,255,.07);}
.dbadge{display:inline-flex;align-items:center;gap:4px;font-family:'Syne',sans-serif;font-size:9px;font-weight:700;letter-spacing:1px;text-transform:uppercase;padding:3px 8px;border-radius:4px;margin-bottom:4px;}
.db-brisbane{background:rgba(26,107,124,.2);color:var(--mint);border:1px solid rgba(77,191,176,.3);}
.db-goldcoast{background:rgba(244,185,66,.15);color:var(--gold);border:1px solid rgba(244,185,66,.3);}
.db-jogging{background:rgba(110,204,114,.12);color:var(--jog);border:1px solid rgba(110,204,114,.3);}
.sb-title{font-family:'Syne',sans-serif;font-size:13px;font-weight:700;color:var(--sand);line-height:1.2;}
.sb-sub{font-size:10px;color:rgba(245,239,224,.38);margin-top:2px;}

/* info strips */
.istrip{flex-shrink:0;margin:8px 14px 0;border-radius:7px;padding:8px 10px;display:flex;gap:7px;align-items:center;}
.is-home{background:rgba(232,99,74,.07);border:1px solid rgba(232,99,74,.2);cursor:pointer;transition:background .2s;}
.is-home:hover{background:rgba(232,99,74,.12);}
.is-trans{background:rgba(77,191,176,.06);border:1px solid rgba(77,191,176,.14);}
.is-jog{background:rgba(110,204,114,.07);border:1px solid rgba(110,204,114,.18);}
.is-icon{font-size:14px;flex-shrink:0;}
.is-text{font-size:10px;color:rgba(245,239,224,.5);line-height:1.5;flex:1;min-width:0;}
.is-text strong{color:var(--mint);}
.is-home .is-text strong{color:#ff8f7a;}
.is-jog .is-text strong{color:var(--jog);}

/* stops list */
.slist{padding:10px 14px 10px;}
.slist::-webkit-scrollbar{width:3px;}
.slist::-webkit-scrollbar-thumb{background:rgba(255,255,255,.1);border-radius:2px;}

.si{display:flex;gap:8px;padding:4px 0;cursor:pointer;}
.si:active .sc,.si:hover .sc{background:rgba(255,255,255,.05);}
.si.active .sc{background:rgba(77,191,176,.06);border-color:rgba(77,191,176,.35);}
.si.si-home .sc{border-color:rgba(232,99,74,.28);background:rgba(232,99,74,.04);}
.si.si-jog-item .sc{border-color:rgba(110,204,114,.18);}
.si.active.si-jog-item .sc{background:rgba(110,204,114,.07);border-color:rgba(110,204,114,.4);}

.stl{display:flex;flex-direction:column;align-items:center;flex-shrink:0;width:24px;}
.sdot{width:24px;height:24px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:'Syne',sans-serif;font-size:10px;font-weight:800;transition:transform .2s;flex-shrink:0;}
.d-brisbane{background:var(--ocean);color:#fff;}
.d-goldcoast{background:var(--gold);color:var(--ink);}
.d-home{background:var(--coral);color:#fff;font-size:13px;}
.d-jog{background:var(--jog);color:#0a1a0a;}
.si.active .sdot{transform:scale(1.15);}
.sline{width:2px;flex:1;min-height:9px;background:rgba(255,255,255,.07);margin:3px 0;}
.si:last-child .sline{display:none;}

.sc{flex:1;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.06);border-radius:8px;padding:9px 11px;transition:all .2s;margin-bottom:5px;}
.stime{font-size:9px;font-weight:600;letter-spacing:1px;text-transform:uppercase;color:rgba(245,239,224,.35);margin-bottom:2px;}
.sname{font-family:'Syne',sans-serif;font-size:12px;font-weight:700;color:var(--sand);line-height:1.2;margin-bottom:2px;}
.sdesc{font-size:10px;color:rgba(245,239,224,.42);line-height:1.5;}
.stags{display:flex;gap:3px;flex-wrap:wrap;margin-top:5px;}
.tag{font-size:8px;font-weight:700;letter-spacing:.3px;padding:2px 5px;border-radius:3px;text-transform:uppercase;}
.tag-free{background:rgba(77,191,176,.15);color:var(--mint);}
.tag-food{background:rgba(232,99,74,.15);color:#ff8f7a;}
.tag-nature{background:rgba(74,180,100,.15);color:#7dd98f;}
.tag-culture{background:rgba(147,112,219,.15);color:#b39ddb;}
.tag-beach{background:rgba(26,107,124,.2);color:#5ec8d8;}
.tag-market{background:rgba(244,185,66,.15);color:var(--gold);}
.tag-home{background:rgba(232,99,74,.15);color:#ff8f7a;}
.tag-jog{background:rgba(110,204,114,.15);color:var(--jog);}
.tag-flat{background:rgba(77,191,176,.12);color:#7dd9d0;}

.dbtn{display:inline-flex;align-items:center;gap:4px;margin-top:7px;font-size:9px;font-weight:600;text-decoration:none;padding:5px 9px;border-radius:5px;transition:all .2s;border:1px solid;}
.dbtn-teal{color:var(--mint);background:rgba(77,191,176,.1);border-color:rgba(77,191,176,.22);}
.dbtn-gold{color:var(--gold);background:rgba(244,185,66,.1);border-color:rgba(244,185,66,.25);}
.dbtn-coral{color:#ff8f7a;background:rgba(232,99,74,.1);border-color:rgba(232,99,74,.25);}
.dbtn-jog{color:var(--jog);background:rgba(110,204,114,.1);border-color:rgba(110,204,114,.25);}

/* â•â• MAP OVERLAYS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.bm-toggle{position:absolute;top:10px;left:10px;z-index:900;display:flex;background:rgba(11,17,32,.9);backdrop-filter:blur(8px);border:1px solid rgba(255,255,255,.12);border-radius:8px;overflow:hidden;}
.bm-btn{font-family:'Syne',sans-serif;font-size:10px;font-weight:700;padding:7px 11px;border:none;cursor:pointer;transition:all .2s;color:rgba(245,239,224,.5);background:transparent;display:flex;align-items:center;gap:4px;white-space:nowrap;}
.bm-btn.bm-active{background:rgba(77,191,176,.18);color:var(--mint);}
.bm-divider{width:1px;background:rgba(255,255,255,.1);}

.mlegend{position:absolute;bottom:16px;right:10px;z-index:900;background:rgba(11,17,32,.92);backdrop-filter:blur(8px);border:1px solid rgba(255,255,255,.1);border-radius:9px;padding:10px 12px;min-width:140px;}
.mlt{font-family:'Syne',sans-serif;font-size:8px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:rgba(245,239,224,.3);margin-bottom:6px;}
.mli{display:flex;align-items:center;gap:6px;margin-bottom:4px;font-size:9px;color:rgba(245,239,224,.6);}
.mld{width:8px;height:8px;border-radius:50%;flex-shrink:0;}
.mll{width:18px;height:0;border-top:2px dashed rgba(255,255,255,.2);flex-shrink:0;}
.mlr{width:18px;height:3px;border-radius:2px;flex-shrink:0;}

/* â•â• MODAL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.modal-backdrop{display:none;position:fixed;inset:0;z-index:3000;background:rgba(0,0,0,.7);backdrop-filter:blur(6px);align-items:flex-end;justify-content:center;}
@media(min-width:500px){.modal-backdrop{align-items:center;}}
.modal-box{
  background:#0f172a;
  border:1px solid rgba(77,191,176,.22);
  border-radius:16px 16px 0 0;
  padding:20px 18px 28px;
  width:100%;max-height:90vh;overflow-y:auto;
}
@media(min-width:500px){.modal-box{border-radius:16px;width:min(390px,95vw);max-height:85vh;padding:22px 20px;}}

.modal-box h2{font-family:'Syne',sans-serif;font-size:15px;font-weight:800;color:#F5EFE0;}
.modal-sub{font-size:10px;color:rgba(245,239,224,.38);margin-top:2px;margin-bottom:16px;}
.modal-close{background:rgba(255,255,255,.07);border:1px solid rgba(255,255,255,.1);border-radius:6px;color:rgba(245,239,224,.6);font-size:14px;padding:4px 9px;cursor:pointer;line-height:1;}

.gps-btn-wrap{width:100%;padding:11px 14px;background:rgba(77,191,176,.1);border:1px solid rgba(77,191,176,.25);border-radius:9px;color:#4DBFB0;font-family:'Syne',sans-serif;font-size:11px;font-weight:700;cursor:pointer;display:flex;align-items:center;gap:8px;margin-bottom:14px;text-align:left;}
.gps-btn-wrap:active{background:rgba(77,191,176,.18);}

.divider-or{display:flex;align-items:center;gap:10px;margin-bottom:12px;}
.divider-or span{font-size:9px;color:rgba(245,239,224,.28);letter-spacing:1px;text-transform:uppercase;white-space:nowrap;}
.divider-or:before,.divider-or:after{content:'';flex:1;height:1px;background:rgba(255,255,255,.07);}

.flabel{font-size:10px;font-weight:600;color:rgba(245,239,224,.45);letter-spacing:.5px;text-transform:uppercase;display:block;margin-bottom:5px;margin-top:10px;}
.finput{width:100%;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);border-radius:7px;padding:10px 12px;color:#F5EFE0;font-family:'DM Sans',sans-serif;font-size:12px;outline:none;transition:border .2s;-webkit-appearance:none;}
.finput:focus{border-color:rgba(77,191,176,.4);}
.row2{display:grid;grid-template-columns:1fr 1fr;gap:8px;}
.loc-err{display:none;font-size:10px;color:#ff8f7a;margin-top:10px;padding:8px 10px;background:rgba(232,99,74,.1);border-radius:6px;border:1px solid rgba(232,99,74,.2);}
.modal-actions{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:16px;}
.btn-reset{padding:11px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.1);border-radius:8px;color:rgba(245,239,224,.55);font-family:'Syne',sans-serif;font-size:10px;font-weight:700;cursor:pointer;}
.btn-save{padding:11px;background:#1A6B7C;border:none;border-radius:8px;color:#fff;font-family:'Syne',sans-serif;font-size:10px;font-weight:700;cursor:pointer;}
.btn-save:active{background:#155a69;}

/* Geocode spinner */
.spin{display:inline-block;width:10px;height:10px;border:2px solid rgba(77,191,176,.3);border-top-color:var(--mint);border-radius:50%;animation:spin .6s linear infinite;}
@keyframes spin{to{transform:rotate(360deg);}}
</style>
</head>
<body>

<header>
  <div class="hbrand">
    <span class="heyebrow">ğŸ‡¦ğŸ‡º Weekend Guide Â· Brisbane</span>
    <h1 class="htitle">Brisbane <span>Explorer</span></h1>
  </div>
  <div class="tabs">
    <button class="tb a-brisbane" id="tb-brisbane"  onclick="switchDest('brisbane')">ğŸ™ï¸ City</button>
    <button class="tb"            id="tb-goldcoast" onclick="switchDest('goldcoast')">ğŸŒŠ GC</button>
    <button class="tb"            id="tb-jogging"   onclick="switchDest('jogging')">ğŸƒ Jogging</button>
  </div>
</header>

<div class="layout">
  <!-- MAP -->
  <div class="mapwrap">
    <div id="map"></div>
    <div class="bm-toggle">
      <button class="bm-btn bm-active" id="bm-dark"      onclick="setBasemap('dark')">ğŸŒ‘ Dark</button>
      <div class="bm-divider"></div>
      <button class="bm-btn"           id="bm-satellite" onclick="setBasemap('satellite')">ğŸ›°ï¸ Sat</button>
    </div>
    <div class="mlegend">
      <div class="mlt">Keterangan</div>
      <div class="mli"><div class="mld" style="background:#E8634A;"></div>Titik Start</div>
      <div class="mli" id="leg-stop"><div class="mld" style="background:#1A6B7C;"></div>Stop</div>
      <div class="mli" id="leg-route"><div class="mll"></div>Rute</div>
    </div>
  </div>

  <!-- SIDEBAR -->
  <div class="sidebar">
    <div class="sb-head">
      <div id="dest-badge" class="dbadge db-brisbane">ğŸ™ï¸ Brisbane City</div>
      <div id="dest-title" class="sb-title">Minggu Seru di Brisbane</div>
      <div id="dest-sub"   class="sb-sub">6 titik Â· ~12 km dari Indooroopilly</div>
    </div>

    <!-- HOME STRIP (clickable) -->
    <div class="istrip is-home" onclick="openModal()" title="Tap untuk ubah titik start">
      <div class="is-icon">ğŸ </div>
      <div class="is-text" style="flex:1;min-width:0;">
        <strong>Titik Start:</strong><br>
        <strong>Bisa disesuaikan klik tombol pensil</strong><br>
        <span id="home-disp-name" style="color:rgba(245,239,224,.75);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block;">Kostan Kang Gifni &amp; Bang Okta</span>
        <span id="home-disp-addr" style="font-size:9px;opacity:.55;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block;">261 Moggill Rd, Indooroopilly</span>
      </div>
      <div style="flex-shrink:0;font-size:12px;color:rgba(77,191,176,.5);padding-left:6px;">âœï¸</div>
    </div>

    <!-- TRANSPORT STRIP -->
    <div id="trans-strip" class="istrip is-trans">
      <div class="is-icon" id="trans-icon">ğŸšŒ</div>
      <div class="is-text" id="trans-text"><strong>Transportasi:</strong> Bus atau CityCat 50Â¢</div>
    </div>

    <div class="slist" id="slist"></div>
  </div>
</div>

<!-- LOCATION MODAL -->
<div class="modal-backdrop" id="loc-modal" onclick="onBackdropClick(event)">
  <div class="modal-box">
    <div style="display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:2px;">
      <div>
        <h2>ğŸ“ Atur Titik Start</h2>
        <p class="modal-sub">Lokasi tersimpan di browser kamu</p>
      </div>
      <button class="modal-close" onclick="closeModal()">âœ•</button>
    </div>

    <!-- GPS BUTTON -->
    <button class="gps-btn-wrap" id="gps-btn" onclick="useGPS()">
      <span style="font-size:18px;">ğŸ“¡</span>
      <span style="flex:1;">Gunakan Lokasi GPS Saya</span>
      <span id="gps-status"></span>
    </button>

    <div class="divider-or"><span>atau isi manual</span></div>

    <label class="flabel">Nama Lokasi</label>
    <input class="finput" id="loc-name" type="text" placeholder="cth: Kamar saya, Hotel ABC..."/>

    <label class="flabel">Alamat <span id="geocode-spinner" style="display:none;"><span class="spin"></span></span></label>
    <input class="finput" id="loc-addr" type="text" placeholder="cth: 261 Moggill Rd, Indooroopilly"/>

    <div class="row2" style="margin-top:10px;">
      <div>
        <label class="flabel" style="margin-top:0;">Latitude</label>
        <input class="finput" id="loc-lat" type="number" step="any" placeholder="-27.5069"/>
      </div>
      <div>
        <label class="flabel" style="margin-top:0;">Longitude</label>
        <input class="finput" id="loc-lng" type="number" step="any" placeholder="152.9765"/>
      </div>
    </div>

    <div class="loc-err" id="loc-err"></div>

    <div class="modal-actions">
      <button class="btn-reset" onclick="resetToDefault()">â†© Reset Default</button>
      <button class="btn-save"  onclick="saveLocation()">âœ“ Simpan</button>
    </div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
<script>
/* â•â•â• DEFAULT HOME â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const HOME_DEFAULT={
  name:'Kostan Kang Gifni & Bang Okta',
  addr:'261 Moggill Rd, Indooroopilly QLD 4068',
  lat:-27.5069, lng:152.9765
};
let HOME=Object.assign({},HOME_DEFAULT);
function homeGmaps(){return `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(HOME.addr||HOME.lat+','+HOME.lng)}`;}

/* â•â•â• STORAGE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function loadSavedHome(){
  try{
    const r=await window.storage.get('user-home-location');
    if(r&&r.value) HOME=JSON.parse(r.value);
  }catch(e){}
  refreshHomeUI();
}
async function persistHome(){
  try{ await window.storage.set('user-home-location',JSON.stringify(HOME)); }catch(e){}
}
async function clearPersistedHome(){
  try{ await window.storage.delete('user-home-location'); }catch(e){}
}

function refreshHomeUI(){
  document.getElementById('home-disp-name').textContent=HOME.name||'Lokasi Saya';
  document.getElementById('home-disp-addr').textContent=HOME.addr||(HOME.lat.toFixed(5)+', '+HOME.lng.toFixed(5));
}

/* â•â•â• REVERSE GEOCODE (Nominatim) â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function reverseGeocode(lat,lng){
  try{
    const url=`https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lng}&format=json&accept-language=id`;
    const res=await fetch(url,{headers:{'Accept-Language':'id'}});
    const data=await res.json();
    return data.display_name||null;
  }catch(e){return null;}
}

/* â•â•â• MODAL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function openModal(){
  document.getElementById('loc-name').value=HOME.name||'';
  document.getElementById('loc-addr').value=HOME.addr||'';
  document.getElementById('loc-lat').value=HOME.lat||'';
  document.getElementById('loc-lng').value=HOME.lng||'';
  document.getElementById('loc-err').style.display='none';
  document.getElementById('gps-status').textContent='';
  document.getElementById('loc-modal').style.display='flex';
  // prevent body scroll on mobile
  document.body.style.overflow='hidden';
}
function closeModal(){
  document.getElementById('loc-modal').style.display='none';
  document.body.style.overflow='';
}
function onBackdropClick(e){if(e.target===document.getElementById('loc-modal'))closeModal();}

function showErr(msg){const el=document.getElementById('loc-err');el.textContent=msg;el.style.display='block';}

/* GPS â€” pakai reverse geocode otomatis isi nama & alamat */
function useGPS(){
  const statusEl=document.getElementById('gps-status');
  const btn=document.getElementById('gps-btn');
  if(!navigator.geolocation){showErr('Browser tidak mendukung GPS.');return;}
  statusEl.innerHTML='<span class="spin"></span>';
  btn.disabled=true; btn.style.opacity='.7';
  document.getElementById('loc-err').style.display='none';

  navigator.geolocation.getCurrentPosition(
    async pos=>{
      const lat=parseFloat(pos.coords.latitude.toFixed(6));
      const lng=parseFloat(pos.coords.longitude.toFixed(6));
      document.getElementById('loc-lat').value=lat;
      document.getElementById('loc-lng').value=lng;
      statusEl.innerHTML='âœ…';
      btn.disabled=false; btn.style.opacity='1';

      // Reverse geocode â†’ isi nama & alamat otomatis
      document.getElementById('geocode-spinner').style.display='inline';
      const addr=await reverseGeocode(lat,lng);
      document.getElementById('geocode-spinner').style.display='none';

      if(addr){
        // Buat nama singkat dari 2 bagian pertama alamat (jalan + suburb)
        const parts=addr.split(',').map(p=>p.trim()).filter(Boolean);
        const shortName=parts.slice(0,2).join(', ');
        document.getElementById('loc-name').value=shortName||'Lokasi GPS Saya';
        document.getElementById('loc-addr').value=addr;
      } else {
        document.getElementById('loc-name').value='Lokasi GPS Saya';
        document.getElementById('loc-addr').value=`${lat}, ${lng}`;
      }
    },
    err=>{
      statusEl.textContent='âŒ';
      btn.disabled=false; btn.style.opacity='1';
      const msgs={1:'Izin lokasi ditolak.',2:'Sinyal GPS tidak ditemukan.',3:'Waktu habis.'};
      showErr('GPS: '+(msgs[err.code]||'Error tidak dikenal.'));
    },
    {enableHighAccuracy:true,timeout:12000,maximumAge:0}
  );
}

async function saveLocation(){
  const name=document.getElementById('loc-name').value.trim();
  const addr=document.getElementById('loc-addr').value.trim();
  const lat=parseFloat(document.getElementById('loc-lat').value);
  const lng=parseFloat(document.getElementById('loc-lng').value);
  document.getElementById('loc-err').style.display='none';
  if(!name){showErr('Nama lokasi tidak boleh kosong.');return;}
  if(isNaN(lat)||isNaN(lng)){showErr('Latitude & Longitude harus berupa angka valid.');return;}
  if(lat<-90||lat>90||lng<-180||lng>180){showErr('Koordinat di luar rentang yang valid.');return;}
  HOME={name,addr:addr||(lat.toFixed(5)+', '+lng.toFixed(5)),lat,lng};
  await persistHome();
  refreshHomeUI();
  closeModal();
  render(_cur);
}

async function resetToDefault(){
  await clearPersistedHome();
  HOME=Object.assign({},HOME_DEFAULT);
  document.getElementById('loc-name').value=HOME.name;
  document.getElementById('loc-addr').value=HOME.addr;
  document.getElementById('loc-lat').value=HOME.lat;
  document.getElementById('loc-lng').value=HOME.lng;
  document.getElementById('loc-err').style.display='none';
  refreshHomeUI();
  closeModal();
  render(_cur);
}

/* â•â•â• DESTINATIONS DATA â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const DESTS={
  brisbane:{
    label:'ğŸ™ï¸ Brisbane City Area',title:'Biar Minggu ga Kosongdi Brisbane',sub:'6 titik',
    trans:'Bus atau CityCat 50Â¢ Â· Semua spot mudah via transportasi umum',
    badgeCls:'db-brisbane',dotCls:'d-brisbane',btnCls:'dbtn dbtn-teal',color:'#1A6B7C',
    center:[-27.490,153.022],zoom:13,showHome:true,
    stops:[
      {n:'1',t:'08:00',name:'Saint and co',             desc:'Brunch pagi di cafÃ© favorit lokal. Kopi enak & harga terjangkau, buka jam 6 pagi.',        tags:['food'],                 lat:-27.5024515,lng:153.0061229},
      {n:'2',t:'10:00',name:'Riverside Sunday Market',  desc:'Market Minggu di tepi Sungai Brisbane. Street food multikultural & produk handmade.',      tags:['market','free'],        lat:-27.4739242,lng:153.0293848},
      {n:'3',t:'12:00',name:'Museum of Brisbane',       desc:'Masuk GRATIS di City Hall ikonik. Pameran sejarah & budaya Brisbane. Buka 10â€“17.',          tags:['free','culture'],       lat:-27.4686797,lng:153.0238277},
      {n:'4',t:'14:00',name:'South Bank Parklands',     desc:'Streets Beach buatan, taman hijau, pemandangan CBD. Gratis 24 jam.',                       tags:['free','nature','beach'],lat:-27.4753665,lng:153.0208068},
      {n:'5',t:'15:30',name:'GOMA & QAG',               desc:'Dua galeri seni GRATIS berdampingan. Pameran imersif kelas dunia. Buka 10â€“17.',              tags:['free','culture'],       lat:-27.4705600,lng:153.0171334},
      {n:'6',t:'16:30',name:'The Collective Markets',   desc:'Market artisan produk unik & makanan enak. Jalan kaki dari South Bank. Tutup 17.00.',       tags:['market','food'],        lat:-27.4790775,lng:153.0223771}
    ]
  },
  goldcoast:{
    label:'ğŸŒŠ Gold Coast',title:'Day Trip Gold Coast',sub:'5 titik Â· Jujur ini agak jauh',
    trans:'Kereta dari Roma Street/Central â†’ G:link tram Â· Total ~1j 50m Â· Tarif ~$3 contactless',
    badgeCls:'db-goldcoast',dotCls:'d-goldcoast',btnCls:'dbtn dbtn-gold',color:'#F4B942',
    center:[-28.060,153.440],zoom:11,showHome:true,
    stops:[
      {n:'1',t:'09:30',name:'Surfers Paradise Beach',      desc:'Pantai ikonik Gold Coast, GRATIS. Pagi lebih sepi, berenang di zona bendera.',              tags:['free','beach','nature'],lat:-27.9992435,lng:153.4314575},
      {n:'2',t:'11:00',name:'Broadwater Parklands',        desc:'Taman tepi laut GRATIS di Southport. Water play, playground & piknik.',                     tags:['free','nature'],        lat:-27.9657753,lng:153.4172077},
      {n:'3',t:'12:30',name:'Hakataya Ramen',              desc:'Ramen Jepang murah di Surfers Paradise. Bisa tambah mie gratis! Buka jam 11.',              tags:['food'],                 lat:-28.0007941,lng:153.4286268},
      {n:'4',t:'14:00',name:'Burleigh Head National Park', desc:'Taman nasional GRATIS. Trek tebing laut ~2km, view headland terbaik di GC! (Based on AI)',                 tags:['free','nature'],        lat:-28.0918206,lng:153.4591743},
      {n:'5',t:'16:00',name:'Coolangatta Beach',           desc:'Pantai tenang di ujung selatan GC. Terbaik untuk sunset sebelum pulang!',                   tags:['free','beach','nature'],lat:-28.1663925,lng:153.5404094}
    ]
  },
  jogging:{
    label:'ğŸƒ Jogging Track',title:'South Bank Jogging Track Asal Jadi',sub:'6 titik Â· ~6 km Â· Datar & nyaman cocok untuk aklimatisasi',
    trans:'CityCat 50Â¢ ke South Bank Pontoon ATAU bus 169/192 ke South Bank',
    badgeCls:'db-jogging',dotCls:'d-jog',btnCls:'dbtn dbtn-jog',color:'#6ECC72',
    center:[-27.477,153.023],zoom:15,showHome:false,
    stops:[
      {n:'1',t:'Start',  name:'South Bank Entry (Selatan)', desc:'Titik awal depan pintu masuk selatan. Parkir gratis pagi di Grey St.',         tags:['jog','free','flat'],lat:-27.4813,lng:153.0217,extra:'Fasilitas: toilet umum & air minum di sini.'},
      {n:'2',t:'~500m',  name:'Streets Beach & Lagoon',    desc:'Lewati Streets Beach ikonik. Trek tepi lagoon, permukaan rata sempurna.',     tags:['jog','flat','beach'],lat:-27.4757,lng:153.0204,extra:'Pagi sangat sepi, suasana sejuk. Bagus untuk foto!'},
      {n:'3',t:'~1.5km', name:'Riverside Promenade',       desc:'Clem Jones Promenade tepi sungai. Beton mulus, view CBD spektakuler.',        tags:['jog','flat'],lat:-27.4748,lng:153.0212,extra:'Trek favorit warga Brisbane pagi hari.'},
      {n:'4',t:'~2.5km', name:'Goodwill Bridge',           desc:'Jembatan pejalan kaki ikonik. Menyeberang ke CBD lalu balik, menambah ~400m.',tags:['jog','free','flat'],lat:-27.4740,lng:153.0241,extra:'Opsi: teruskan ke City Botanic Gardens.'},
      {n:'5',t:'~3.5km', name:'Little Stanley St & GOMA',  desc:'Putar lewat depan GOMA & QAG. Trotoar lebar, teduh, banyak pohon.',          tags:['jog','flat'],lat:-27.4724,lng:153.0185,extra:'Ada air mancur & tempat duduk untuk rehat.'},
      {n:'6',t:'~5km',   name:'Epicurious Garden â€” Finish',desc:'Finish di kebun herbal komunitas South Bank. Fasilitas lengkap di sekitar.',  tags:['jog','free','flat'],lat:-27.4801,lng:153.0245,extra:'Rekomendasi: mampir kafe South Bank setelah lari!'}
    ]
  }
};
const TAGL={free:'Gratis',food:'Kuliner',nature:'Alam',culture:'Budaya',beach:'Pantai',market:'Market',home:'Home',jog:'Jogging',flat:'Datar'};

/* â•â•â• MAP INIT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const map=L.map('map',{center:[-27.490,153.022],zoom:13,zoomControl:false});
L.control.zoom({position:'topright'}).addTo(map);

const _layers={
  dark:L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png',{attribution:'&copy; CARTO &copy; OSM',maxZoom:19}),
  satellite:L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',{attribution:'Tiles &copy; Esri',maxZoom:19}),
  satLabels:L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_only_labels/{z}/{x}/{y}{r}.png',{attribution:'',maxZoom:19,pane:'shadowPane'})
};
let _curBM='dark';
_layers.dark.addTo(map);

function setBasemap(m){
  if(m===_curBM)return;
  if(_curBM==='dark'){map.removeLayer(_layers.dark);}
  else{map.removeLayer(_layers.satellite);map.removeLayer(_layers.satLabels);}
  if(m==='dark'){_layers.dark.addTo(map);}
  else{_layers.satellite.addTo(map);_layers.satLabels.addTo(map);}
  _curBM=m;
  document.getElementById('bm-dark').classList.toggle('bm-active',m==='dark');
  document.getElementById('bm-satellite').classList.toggle('bm-active',m==='satellite');
}

/* Popup CSS */
const _ps=document.createElement('style');
_ps.textContent=`.gp .leaflet-popup-content-wrapper{background:transparent!important;box-shadow:0 8px 28px rgba(0,0,0,.75)!important;border-radius:12px!important;padding:0!important;overflow:hidden;}.gp .leaflet-popup-content{margin:0!important;width:auto!important;}.gp .leaflet-popup-tip{display:none;}.gp .leaflet-popup-close-button{color:rgba(245,239,224,.5)!important;font-size:16px!important;top:5px!important;right:7px!important;z-index:10;}`;
document.head.appendChild(_ps);

let _mks=[],_poly=null,_homeM=null,_jogPoly=null;

/* â•â•â• ICONS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function mkPinIcon(lbl,bg,fg='#fff'){
  return L.divIcon({className:'',
    html:`<div style="width:28px;height:28px;background:${bg};border-radius:50% 50% 50% 0;transform:rotate(-45deg);border:2px solid rgba(255,255,255,.2);box-shadow:0 3px 10px rgba(0,0,0,.5);display:flex;align-items:center;justify-content:center;"><span style="transform:rotate(45deg);font-family:Syne,sans-serif;font-weight:800;font-size:11px;color:${fg};line-height:1;">${lbl}</span></div>`,
    iconSize:[28,28],iconAnchor:[14,28],popupAnchor:[0,-32]});
}
function mkHomeIcon(){
  return L.divIcon({className:'',
    html:`<div style="width:32px;height:32px;background:#E8634A;border-radius:50%;border:3px solid rgba(255,255,255,.3);box-shadow:0 3px 12px rgba(232,99,74,.6);display:flex;align-items:center;justify-content:center;font-size:15px;">ğŸ </div>`,
    iconSize:[32,32],iconAnchor:[16,16],popupAnchor:[0,-18]});
}
function mkJogIcon(lbl){
  return L.divIcon({className:'',
    html:`<div style="width:28px;height:28px;background:#6ECC72;border-radius:50%;border:2px solid rgba(255,255,255,.25);box-shadow:0 2px 10px rgba(110,204,114,.5);display:flex;align-items:center;justify-content:center;font-family:Syne,sans-serif;font-weight:800;font-size:11px;color:#0a1a0a;">${lbl}</div>`,
    iconSize:[28,28],iconAnchor:[14,14],popupAnchor:[0,-16]});
}

/* â•â•â• POPUP HTML â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function homePopupHtml(){
  return `<div style="font-family:'DM Sans',sans-serif;background:#0b1120;border-radius:12px;padding:13px 15px;min-width:190px;border:1px solid rgba(232,99,74,.25);">
  <div style="font-size:8px;letter-spacing:2px;text-transform:uppercase;color:rgba(245,239,224,.3);margin-bottom:3px;">ğŸ  TITIK KEBERANGKATAN</div>
  <div style="font-family:Syne,sans-serif;font-size:12px;font-weight:700;color:#F5EFE0;margin-bottom:3px;">${HOME.name}</div>
  <div style="font-size:10px;color:rgba(245,239,224,.45);margin-bottom:9px;">${HOME.addr}</div>
  <a href="${homeGmaps()}" target="_blank" style="display:inline-flex;align-items:center;gap:5px;font-size:9px;font-weight:700;color:#ff8f7a;text-decoration:none;padding:5px 10px;background:rgba(232,99,74,.12);border:1px solid rgba(232,99,74,.28);border-radius:5px;width:100%;justify-content:center;">
    <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polygon points="3 11 22 2 13 21 11 13 3 11"/></svg>Lihat di Google Maps
  </a></div>`;
}

function stopPopupHtml(st,destKey){
  const isJog=destKey==='jogging';
  const tc=isJog?'#6ECC72':destKey==='goldcoast'?'#F4B942':'#4DBFB0';
  const bg=isJog?'rgba(110,204,114,.1)':destKey==='goldcoast'?'rgba(244,185,66,.1)':'rgba(77,191,176,.1)';
  const bc=isJog?'rgba(110,204,114,.3)':destKey==='goldcoast'?'rgba(244,185,66,.3)':'rgba(77,191,176,.28)';
  const gmaps=`https://www.google.com/maps/dir/?api=1&destination=${st.lat},${st.lng}&travelmode=${isJog?'walking':'transit'}`;
  const tags=st.tags.map(t=>`<span style="font-size:8px;font-weight:700;padding:2px 5px;border-radius:3px;text-transform:uppercase;background:rgba(77,191,176,.14);color:#4DBFB0;margin-right:3px;">${TAGL[t]||t}</span>`).join('');
  const extra=st.extra?`<div style="font-size:10px;color:rgba(110,204,114,.7);margin-top:6px;padding-top:6px;border-top:1px solid rgba(255,255,255,.07);line-height:1.4;">â„¹ï¸ ${st.extra}</div>`:'';
  return `<div style="font-family:'DM Sans',sans-serif;background:#0b1120;border-radius:12px;padding:13px 15px;min-width:200px;max-width:240px;border:1px solid rgba(255,255,255,.07);">
  <div style="font-size:8px;letter-spacing:2px;text-transform:uppercase;color:rgba(245,239,224,.3);margin-bottom:3px;">Stop ${st.n} Â· ${st.t}</div>
  <div style="font-family:Syne,sans-serif;font-size:12px;font-weight:700;color:#F5EFE0;margin-bottom:4px;line-height:1.2;">${st.name}</div>
  <div style="font-size:10px;color:rgba(245,239,224,.46);line-height:1.5;margin-bottom:7px;">${st.desc}</div>
  <div style="margin-bottom:8px;">${tags}</div>${extra}
  <a href="${gmaps}" target="_blank" style="display:inline-flex;align-items:center;gap:5px;font-size:9px;font-weight:700;color:${tc};text-decoration:none;padding:5px 10px;background:${bg};border:1px solid ${bc};border-radius:5px;width:100%;justify-content:center;margin-top:8px;">
    <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polygon points="3 11 22 2 13 21 11 13 3 11"/></svg>
    ${isJog?'Navigasi ke Sini':'Buka Google Maps Directions'}
  </a></div>`;
}

/* â•â•â• RENDER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function render(destKey){
  const d=DESTS[destKey];
  const isJog=destKey==='jogging';

  _mks.forEach(m=>map.removeLayer(m));_mks=[];
  if(_poly){map.removeLayer(_poly);_poly=null;}
  if(_homeM){map.removeLayer(_homeM);_homeM=null;}
  if(_jogPoly){map.removeLayer(_jogPoly);_jogPoly=null;}

  document.getElementById('dest-badge').textContent=d.label;
  document.getElementById('dest-badge').className='dbadge '+d.badgeCls;
  document.getElementById('dest-title').textContent=d.title;
  document.getElementById('dest-sub').textContent=d.sub;
  document.getElementById('trans-text').innerHTML='<strong>Transportasi:</strong> '+d.trans;
  const ts=document.getElementById('trans-strip');
  ts.className='istrip '+(isJog?'is-jog':'is-trans');
  document.getElementById('trans-icon').textContent=isJog?'ğŸƒ':'ğŸšŒ';
  document.getElementById('leg-stop').innerHTML=`<div class="mld" style="background:${d.color};"></div>${isJog?'Checkpoint':'Stop'}`;
  const lr=document.getElementById('leg-route');
  lr.innerHTML=isJog?`<div class="mlr" style="background:rgba(110,204,114,.5);"></div>Rute lari`:`<div class="mll"></div>Rute`;

  if(d.showHome){
    _homeM=L.marker([HOME.lat,HOME.lng],{icon:mkHomeIcon()}).addTo(map)
           .bindPopup(homePopupHtml(),{maxWidth:260,className:'gp'});
  }
  if(isJog){
    const pts=[...d.stops.map(s=>[s.lat,s.lng]),[d.stops[0].lat,d.stops[0].lng]];
    _jogPoly=L.polyline(pts,{color:'#6ECC72',weight:4,opacity:.55}).addTo(map);
  } else {
    const pts=[[HOME.lat,HOME.lng],...d.stops.map(s=>[s.lat,s.lng])];
    _poly=L.polyline(pts,{color:d.color,weight:2,opacity:.4,dashArray:'7 5'}).addTo(map);
  }
  d.stops.forEach((st,i)=>{
    const icon=isJog?mkJogIcon(st.n):mkPinIcon(st.n,d.color,destKey==='goldcoast'?'#1C1C2E':'#fff');
    const m=L.marker([st.lat,st.lng],{icon}).addTo(map)
             .bindPopup(stopPopupHtml(st,destKey),{maxWidth:260,className:'gp'});
    m.on('click',()=>hlStop(i));
    _mks.push(m);
  });
  map.setView(d.center,d.zoom);
  buildList(d,destKey);
}

/* â•â•â• SIDEBAR LIST â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function buildList(d,destKey){
  const list=document.getElementById('slist');
  list.innerHTML='';
  const isJog=destKey==='jogging';

  if(d.showHome){
    const hr=document.createElement('div');
    hr.className='si si-home';
    hr.innerHTML=`<div class="stl"><div class="sdot d-home">ğŸ </div><div class="sline"></div></div>
    <div class="sc">
      <div class="stime">Titik Keberangkatan</div>
      <div class="sname">${HOME.name}</div>
      <div class="sdesc">${HOME.addr}</div>
      <div class="stags"><span class="tag tag-home">Start</span></div>
      <a class="dbtn dbtn-coral" href="${homeGmaps()}" target="_blank">
        <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polygon points="3 11 22 2 13 21 11 13 3 11"/></svg>Lihat di Google Maps
      </a>
    </div>`;
    hr.addEventListener('click',()=>{map.setView([HOME.lat,HOME.lng],15);setTimeout(()=>_homeM&&_homeM.openPopup(),200);setActive(-1);});
    list.appendChild(hr);
  }

  if(isJog){
    const info=document.createElement('div');
    info.style.cssText='background:rgba(110,204,114,.07);border:1px solid rgba(110,204,114,.2);border-radius:7px;padding:9px 11px;margin-bottom:5px;font-size:10px;color:rgba(245,239,224,.55);line-height:1.6;';
    info.innerHTML=`<div style="font-family:Syne,sans-serif;font-weight:700;font-size:11px;color:#6ECC72;margin-bottom:3px;">â„¹ï¸ Info Rute</div>
    <b style="color:rgba(245,239,224,.7);">Total:</b> ~5â€“6 km &nbsp;Â·&nbsp; <b style="color:rgba(245,239,224,.7);">Elevasi:</b> hampir nol &nbsp;Â·&nbsp; <b style="color:rgba(245,239,224,.7);">Permukaan:</b> beton mulus &nbsp;Â·&nbsp; Ideal pukul 06â€“08 pagi.`;
    list.appendChild(info);
  }

  d.stops.forEach((st,i)=>{
    const tags=st.tags.map(t=>`<span class="tag tag-${t}">${TAGL[t]||t}</span>`).join('');
    const gmaps=`https://www.google.com/maps/dir/?api=1&destination=${st.lat},${st.lng}&travelmode=${isJog?'walking':'transit'}`;
    const row=document.createElement('div');
    row.className='si'+(isJog?' si-jog-item':'');
    row.id='si-'+i;
    row.innerHTML=`<div class="stl"><div class="sdot ${d.dotCls}">${st.n}</div><div class="sline"></div></div>
    <div class="sc">
      <div class="stime">${st.t}</div>
      <div class="sname">${st.name}</div>
      <div class="sdesc">${st.desc}</div>
      <div class="stags">${tags}</div>
      <a class="${d.btnCls}" href="${gmaps}" target="_blank">
        <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polygon points="3 11 22 2 13 21 11 13 3 11"/></svg>
        ${isJog?'Navigasi ke Sini':'Arah Google Maps'}
      </a>
    </div>`;
    row.addEventListener('click',()=>{
      map.setView([st.lat,st.lng],16);
      setTimeout(()=>_mks[i]&&_mks[i].openPopup(),200);
      hlStop(i);
    });
    list.appendChild(row);
  });
}

function hlStop(idx){setActive(idx);const el=document.getElementById('si-'+idx);if(el)el.scrollIntoView({behavior:'smooth',block:'nearest'});}
function setActive(idx){
  document.querySelectorAll('#slist .si').forEach((el,i)=>{
    const off=DESTS[_cur].showHome?1:0;
    el.classList.toggle('active',idx===-1?i===0:i===idx+off);
  });
}

/* â•â•â• TAB SWITCH â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let _cur='brisbane';
function switchDest(d){
  _cur=d;
  document.getElementById('tb-brisbane').className ='tb'+(d==='brisbane'?' a-brisbane':'');
  document.getElementById('tb-goldcoast').className='tb'+(d==='goldcoast'?' a-goldcoast':'');
  document.getElementById('tb-jogging').className  ='tb'+(d==='jogging'?' a-jogging':'');
  render(d);
}

/* â•â•â• INIT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
loadSavedHome().then(()=>render('brisbane'));
</script>
</body>
</html>
